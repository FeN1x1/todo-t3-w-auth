import type { NextPage } from "next";
import { useState } from "react";
import Head from "next/head";
import Input from "../components/Input";
import { trpc } from "../utils/trpc";
import List from "../components/List";
import { useSession } from "next-auth/react";

const Home: NextPage = () => {
  const create = trpc.todo.create.useMutation();
  const getAll = trpc.todo.getAll.useQuery();
  const deletion = trpc.todo.delete.useMutation();
  const { data: session } = useSession();

  const [input, setInput] = useState<string>("");

  // const mutateTest = trpc.example.writeOne.useMutation();

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setInput(e.target.value);
  };

  const handleCreateTodo = () => {
    if (input !== "") {
      create.mutate({ text: input });
      getAll.refetch();
      setInput("");
    }
  };

  const handleDeleteTodo = (id: string) => {
    deletion.mutate({ id: id });
    getAll.refetch();
  };

  return (
    <>
      <Head>
        <title>Create T3 App TODO</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {session ? (
        <>
          <Input
            value={input}
            handleOnChange={handleInputChange}
            handleOnClick={handleCreateTodo}
          />
          <List handleOnClick={handleDeleteTodo} todos={getAll?.data} />
        </>
      ) : (
        <div>Please log in to see your todos</div>
      )}
    </>
  );
};

export default Home;
